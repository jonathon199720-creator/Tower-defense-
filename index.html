<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mobile Tower Defense</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<style>
body {
  margin: 0;
  background: #0b1220;
  color: white;
  font-family: system-ui, sans-serif;
  text-align: center;
}

#ui {
  display: flex;
  justify-content: space-around;
  padding: 10px;
  background: #111a30;
  position: sticky;
  top: 0;
}

button {
  padding: 10px 14px;
  font-size: 16px;
  background: #2563eb;
  color: white;
  border: none;
  border-radius: 8px;
}

canvas {
  display: block;
  margin: auto;
  background: #1a2440;
  touch-action: none;
}
</style>
</head>

<body>

<h2>Mobile Tower Defense</h2>

<div id="ui">
  <div>‚ù§Ô∏è <span id="lives">20</span></div>
  <div>üí∞ <span id="gold">100</span></div>
  <div>Lvl <span id="level">1</span></div>
  <button onclick="startPlacing()">Tower (50)</button>
</div>

<canvas id="game" width="360" height="540"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const TILE = 60;
const COLS = 6;
const ROWS = 9;

let lives = 20;
let gold = 100;
let level = 1;
let placing = false;

const towers = [];
const enemies = [];

/* ======================
   AUTO SPRITES
====================== */
function sprite(color) {
  const c = document.createElement("canvas");
  c.width = c.height = TILE;
  const g = c.getContext("2d");
  g.fillStyle = color;
  g.fillRect(6, 6, TILE - 12, TILE - 12);
  g.strokeStyle = "#fff";
  g.lineWidth = 2;
  g.strokeRect(6, 6, TILE - 12, TILE - 12);
  return c;
}

const towerSprite = sprite("#3b82f6");
const enemySprite = sprite("#ef4444");
const pathSprite  = sprite("#374151");

/* ======================
   PATH
====================== */
const path = [
  {x:0,y:4},{x:1,y:4},{x:2,y:4},
  {x:3,y:4},{x:4,y:4},{x:5,y:4}
];

/* ======================
   INPUT
====================== */
function startPlacing() {
  if (gold >= 50) placing = true;
}

canvas.addEventListener("touchstart", e => {
  if (!placing) return;

  const rect = canvas.getBoundingClientRect();
  const t = e.touches[0];
  const x = Math.floor((t.clientX - rect.left) / TILE);
  const y = Math.floor((t.clientY - rect.top) / TILE);

  if (path.some(p => p.x === x && p.y === y)) return;
  if (towers.some(t => t.x === x && t.y === y)) return;

  towers.push({ x, y, cooldown: 0 });
  gold -= 50;
  placing = false;
  updateUI();
});

/* ======================
   ENEMIES
====================== */
function spawnEnemy() {
  enemies.push({
    x: path[0].x * TILE,
    y: path[0].y * TILE,
    step: 0,
    hp: 10 + level * 2
  });
}

/* ======================
   GAME LOOP
====================== */
function update() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // path
  path.forEach(p => {
    ctx.drawImage(pathSprite, p.x*TILE, p.y*TILE);
  });

  // towers
  towers.forEach(t => {
    ctx.drawImage(towerSprite, t.x*TILE, t.y*TILE);
    t.cooldown--;
  });

  // enemies
  for (let i = enemies.length - 1; i >= 0; i--) {
    const e = enemies[i];
    const next = path[e.step + 1];

    if (next) {
      const tx = next.x * TILE;
      const ty = next.y * TILE;
      const dx = tx - e.x;
      const dy = ty - e.y;
      const d = Math.hypot(dx, dy);

      e.x += dx / d;
      e.y += dy / d;
      if (d < 2) e.step++;
    } else {
      lives--;
      enemies.splice(i,1);
      updateUI();
      continue;
    }

    ctx.drawImage(enemySprite, e.x, e.y);
  }

  // shooting
  towers.forEach(t => {
    if (t.cooldown > 0) return;

    enemies.forEach((e, i) => {
      const dx = e.x - t.x*TILE;
      const dy = e.y - t.y*TILE;
      if (Math.hypot(dx, dy) < 120) {
        e.hp -= 5;
        t.cooldown = 30;
        if (e.hp <= 0) {
          enemies.splice(i,1);
          gold += 10;
          updateUI();
        }
      }
    });
  });

  requestAnimationFrame(update);
}

/* ======================
   UI
====================== */
function updateUI() {
  livesEl.textContent = lives;
  goldEl.textContent = gold;
  levelEl.textContent = level;
}

const livesEl = document.getElementById("lives");
const goldEl = document.getElementById("gold");
const levelEl = document.getElementById("level");

setInterval(spawnEnemy, 1200);
setInterval(() => { level++; updateUI(); }, 15000);

updateUI();
update();
</script>

</body>
</html>
