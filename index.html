<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Strategy Defense</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<style>
body {
  margin: 0;
  background: #0b0f1a;
  color: white;
  font-family: Arial, sans-serif;
  overflow: hidden;
}

#ui {
  display: flex;
  justify-content: space-between;
  padding: 10px;
  background: linear-gradient(90deg,#111,#1b2340);
}

button {
  min-height: 48px;
  padding: 10px 16px;
  font-size: 16px;
  background: #2b6cff;
  color: white;
  border: none;
  border-radius: 8px;
}

button:active {
  transform: scale(0.96);
}

#stats {
  font-size: 14px;
}
</style>
</head>

<body>

<div id="ui">
  <button onclick="startPlacing()">Place Tower ($50)</button>
  <div id="stats"></div>
</div>

<canvas id="game"></canvas>

<script>
/* =====================
   CANVAS SETUP
===================== */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight - 70;
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

/* =====================
   EMBEDDED SPRITES
===================== */
function loadSprite(base64) {
  const img = new Image();
  img.src = base64;
  return img;
}

const sprites = {
  tower: loadSprite("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABF0lEQVRYR+2XwQ3DIAxF3Yp0A0XQDN1A00QDN0A00QDT9p4MSyY9uJ5v0+3b4AJmSBB9P0B0vQpXxW6AHk4VdArwN0C0cQ9e+AQxBHwHhAjz6ABZC7J9AXeAFYB9iJ4GkAl8B7gI2AK+g2kF3Y8w6bZb9lU1A6t1lF1mS0M6tG0nV0j2m1rY0x2q0h0Z7Z3A8YqvXfYw5A4L8FvM0A8QYw2n8o5QH9B0Fz9Ck6b8pYx8D0R9h9Yg7mZz+gJ2QJ9q6v8WgAAAABJRU5ErkJggg=="),
  enemy: loadSprite("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABHUlEQVRYR+2XwQ3DIAxF3Yp0A0XQDN1A00QDN0A00QDT9p4MSyY9uJ5v0+3b4AJmSBB9P0B0vQpXxW6AHk4VdArwN0C0cQ9e+AQxBHwHhAjz6ABZC7J9AXeAFYB9iJ4GkAl8B7gI2AK+g2kF3Y8w6bZb9lU1A6t1lF1mS0M6tG0nV0j2m1rY0x2q0h0Z7Z3A8YqvXfYw5A4L8FvM0A8QYw2n8o5QH9B0Fz9Ck6b8pYx8D0R9h9Yg7mZz+gJ2QJ9q6v8WgAAAABJRU5ErkJggg=="),
  boss: loadSprite("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABQElEQVRYR+2XwQ3DIAxF3Yp0A0XQDN1A00QDN0A00QDT9p4MSyY9uJ5v0+3b4AJmSBB9P0B0vQpXxW6AHk4VdArwN0C0cQ9e+AQxBHwHhAjz6ABZC7J9AXeAFYB9iJ4GkAl8B7gI2AK+g2kF3Y8w6bZb9lU1A6t1lF1mS0M6tG0nV0j2m1rY0x2q0h0Z7Z3A8YqvXfYw5A4L8FvM0A8QYw2n8o5QH9B0Fz9Ck6b8pYx8D0R9h9Yg7mZz+gJ2QJ9q6v8WgAAAABJRU5ErkJggg==")
};

/* =====================
   GAME STATE
===================== */
let money = 100;
let level = 1;
let placing = false;

const towers = [];
const enemies = [];

/* =====================
   CLASSES
===================== */
class Tower {
  constructor(x, y) {
    this.x = x;
    this.y = y;
    this.range = 120;
    this.cooldown = 0;
  }

  update() {
    this.cooldown--;
    if (this.cooldown <= 0) {
      for (let e of enemies) {
        const d = Math.hypot(this.x - e.x, this.y - e.y);
        if (d < this.range) {
          e.health -= 10;
          this.cooldown = 30;
          break;
        }
      }
    }
  }

  draw() {
    ctx.drawImage(sprites.tower, this.x - 16, this.y - 16, 32, 32);
  }
}

class Enemy {
  constructor(boss=false) {
    this.x = -30;
    this.y = canvas.height / 2;
    this.health = boss ? 300 : 50;
    this.speed = boss ? 0.5 : 1.2;
    this.boss = boss;
  }

  update() {
    this.x += this.speed;
  }

  draw() {
    const img = this.boss ? sprites.boss : sprites.enemy;
    ctx.drawImage(img, this.x - 16, this.y - 16, 32, 32);
  }
}

/* =====================
   INPUT
===================== */
canvas.addEventListener("touchstart", e => {
  if (!placing) return;
  const rect = canvas.getBoundingClientRect();
  const t = e.touches[0];
  placeTower(t.clientX - rect.left, t.clientY - rect.top);
});

canvas.addEventListener("mousedown", e => {
  if (!placing) return;
  placeTower(e.offsetX, e.offsetY);
});

function startPlacing() {
  if (money >= 50) placing = true;
}

function placeTower(x, y) {
  towers.push(new Tower(x, y));
  money -= 50;
  placing = false;
}

/* =====================
   GAME LOOP
===================== */
function spawnWave() {
  for (let i = 0; i < level + 2; i++) {
    enemies.push(new Enemy());
  }
  if (level % 10 === 0) enemies.push(new Enemy(true));
}

spawnWave();

function loop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  for (let i = towers.length - 1; i >= 0; i--) {
    towers[i].update();
    towers[i].draw();
  }

  for (let i = enemies.length - 1; i >= 0; i--) {
    const e = enemies[i];
    e.update();
    e.draw();

    if (e.health <= 0) {
      money += 10;
      enemies.splice(i, 1);
    }
  }

  if (enemies.length === 0) {
    level++;
    spawnWave();
  }

  document.getElementById("stats").innerText =
    `Level: ${level} | Money: $${money}`;

  requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>
